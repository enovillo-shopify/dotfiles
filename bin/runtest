#!/usr/bin/env python3

import glob
import subprocess
import sys


def main(args):
  if len(args) >= 1:
    test_ids = args[0].split(":")

    if len(test_ids) != 2:
      print(f"Bad test spec: {args[0]}")

    else:
      fnames =glob.glob(f"**/{test_ids[0]}_test.rb", recursive = True)
      if len(fnames) == 0:
        print(f"Test not found: {test_ids[0]}")

      elif len(fnames) == 1:
        command = ["bin/rails", "test", f"{fnames[0]}:{test_ids[1]}"]
        print(' '.join(command))
        subprocess.run(command)

      else:
        print(f"Which file?")
        print(*fnames, sep = "\n")
  else:
    print("No test file given.")


if __name__ == "__main__":
  main(sys.argv[1:])
